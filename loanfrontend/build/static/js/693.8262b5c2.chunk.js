"use strict";(self.webpackChunkloan_management=self.webpackChunkloan_management||[]).push([[693],{9693:function(e,r,a){a.r(r),a.d(r,{default:function(){return V}});var l=a(9950),n=a(16491),t=a(82053),o=a(25333),s=a(19808),i=a(93230),d=a(10226),u=a(48089),c=a(35777),m=a(55035),h=a(73062),A=a(63464),x=a(40033),f=a(28170),v=a(6493),p=a(60899),j=a(16497),y=a(93038),b=a(8145),w=a(79739),D=a(7762),g=a(43939),C=a(60666),R=a(29277),S=a(25979),T=a(70006),B=a(23266),L=a(24516),N=a(27232),k=a(4159),q=a.n(k),P=a(44414);const z=(e,r)=>Number(Math.round(e+"e"+r)+"e-"+r);var I=e=>{const{open:r,handleClose:a,AddLoanData:o,loanTypeData:s,borrowerData:i,walletData:u,editLoanData:c,setEditLoanData:m,UpDateLoanData:h,landersData:k,loanOffersData:I}=e,F=localStorage.getItem("user_id"),[_,$]=(0,l.useState)(""),[Y,O]=(0,l.useState)(""),W=C.Ik({loanType:C.Yj().required("loan Type is required"),borrowers:C.Yj().required("Borrowers is required"),loanStatus:C.Yj().required("loan Status is required"),landers:C.Yj().required("Landers  is required"),principleAmount:C.Yj().required("principle Amount  is required"),loanDuration:C.ai().required("Loan duration is required").positive("Loan duration must be a positive number").integer("Loan duration must be a whole number"),durationPeriod:C.Yj().required("Duration Period is required"),releaseDate:C.Yj().required("Release Date To is required"),repaymentAmount:C.Yj().required("Release Date is required"),interestAmount:C.Yj().required("Repayment Amount is required"),interestRate:C.Yj().required("Interest Rate is required"),fromAccount:C.Yj().required("fromAccount is required"),TransactionReference:C.Yj().required("Transaction Reference is required")}),V={loanType:c?c.loanType:"",borrowers:c?_:"",SelectOffers:!1,loanStatus:c?c.loanStatus:"",landers:c?c.landers:"",principleAmount:c?c.principleAmount:"",loanDuration:c?c.loanDuration:"",durationPeriod:c?c.durationPeriod:"",releaseDate:c?c.releaseDate:"",repaymentAmount:c?c.repaymentAmount:"",interestAmount:c?c.interestAmount:"",interestRate:c?c.interestRate:"",fromAccount:c?c.fromAccount:"",TransactionReference:c?c.TransactionReference:"",createdBy:F},E=(0,g.Wx)({initialValues:V,validationSchema:W,enableReinitialize:!0,onSubmit:async(e,r)=>{let{resetForm:l}=r;c?h(e):o(e),a(),m(""),!c&&N.oR.success(" Add Loans successfully"),l()}}),M=(e,r,a,l)=>{const n=12*e;return z(a===n-1?r-l:r/n,2)},U=(e,r,a,l)=>{const n=z(((e,r,a,l)=>{let n=0;switch(l){case"daily":n=r/365;break;case"weekly":n=r/52;break;case"monthly":n=r/12;break;case"yearly":n=r;break;default:return 0}return e*n*a/100})(e,r,a,l),2),t=z(e+n,2),o=12*a;let s=[],i=t;for(let d=0;d<o;d++){const e=M(a,t,d,t-i);s.push(e),i=z(i-e,2)}s[o-1]+=i,E.setFieldValue("interestAmount",parseInt(n)),E.setFieldValue("repaymentAmount",t),E.setFieldValue("monthlyEmi",s[0])};(0,l.useEffect)((()=>{if(null!==c&&void 0!==c&&c.borrowers){const{_id:e}=c.borrowers;$(e)}}),[c]);return(0,P.jsx)("div",{children:(0,P.jsxs)(A.A,{open:r,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[(0,P.jsxs)(x.A,{id:"scroll-dialog-title",style:{display:"flex",justifyContent:"space-between"},children:[(0,P.jsxs)(t.A,{variant:"h6",children:[" ",c?"Edit Loan":"Create Loan "]}),(0,P.jsx)(t.A,{children:(0,P.jsx)(D.A,{onClick:a,style:{cursor:"pointer"}})})]}),(0,P.jsx)(f.A,{dividers:!0,children:(0,P.jsx)("form",{children:(0,P.jsx)(v.A,{id:"scroll-dialog-description",tabIndex:-1,children:(0,P.jsxs)(p.Ay,{container:!0,rowSpacing:3,columnSpacing:{xs:0,sm:5,md:4},children:[(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Loan Type"}),(0,P.jsxs)(S.A,{fullWidth:!0,children:[(0,P.jsx)(T.A,{labelId:"demo-simple-select-label",id:"",name:"loanType",label:"",size:"small",value:E.values.loanType,onChange:e=>{const r=e.target.value;E.setFieldValue("loanType",r);const a=s.find((e=>e.loanName===r));a&&(E.setFieldValue("durationPeriod",a.interestCycle),E.setFieldValue("interestRate",a.interestRate),O(null===a||void 0===a?void 0:a.interestRate))},error:E.touched.loanType&&Boolean(E.errors.loanType),children:null===s||void 0===s?void 0:s.map((e=>(0,P.jsx)(B.A,{value:e.loanName,children:e.loanName},e._id)))}),(0,P.jsx)(L.A,{error:E.touched.loanType&&Boolean(E.errors.loanType),children:E.touched.loanType&&E.errors.loanType})]})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Borrowers"}),(0,P.jsxs)(S.A,{fullWidth:!0,children:[(0,P.jsx)(T.A,{labelId:"demo-simple-select-label",id:"",name:"borrowers",label:"",size:"small",value:E.values.borrowers||null,onChange:E.handleChange,error:E.touched.borrowers&&Boolean(E.errors.borrowers),children:null===i||void 0===i?void 0:i.map((e=>(0,P.jsx)(B.A,{value:e._id,children:`${e.firstName}${e.lastName}-${e.phoneNumber}`},e._id)))}),(0,P.jsx)(L.A,{error:E.touched.borrowers&&Boolean(E.errors.borrowers),children:E.touched.borrowers&&E.errors.borrowers})]})]}),(0,P.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:(0,P.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,P.jsx)(R.A,{children:"If you want to give loan offers to Borrowers"}),(0,P.jsx)(j.A,{name:"SelectOffers",control:(0,P.jsx)(y.A,{checked:E.values.SelectOffers,onChange:e=>{const r=e.target.checked;E.setFieldValue("SelectOffers",r),r||(E.setFieldValue("loanOffer",null),E.setFieldValue("interestRate",Y),U(E.values.principleAmount,Y,E.values.loanDuration,E.values.durationPeriod))},name:"loanOfferCheckbox"}),label:"Select Loan Offer"})]})}),E.values.SelectOffers&&(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Loan Offer"}),(0,P.jsx)(S.A,{fullWidth:!0,children:(0,P.jsx)(T.A,{labelId:"loan-offer-select-label",id:"loanOffer",name:"loanOffer",size:"small",value:E.values.loanOffer||"",onChange:e=>{const r=e.target.value;E.setFieldValue("loanOffer",r);const a=I.find((e=>e._id===r));if(a){const e=E.values.interestRate-a.interestRate;E.setFieldValue("interestRate",e),U(E.values.principleAmount,e,E.values.loanDuration,E.values.durationPeriod)}},children:null===I||void 0===I?void 0:I.map((e=>(0,P.jsx)(B.A,{value:e._id,children:e.offerName},e._id)))})})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Landers"}),(0,P.jsxs)(S.A,{fullWidth:!0,children:[(0,P.jsx)(T.A,{labelId:"demo-simple-select-label",id:"",name:"landers",label:"",size:"small",value:E.values.landers||null,onChange:E.handleChange,error:E.touched.landers&&Boolean(E.errors.landers),children:null===k||void 0===k?void 0:k.map((e=>(0,P.jsx)(B.A,{value:e._id,children:`${e.landersName}`},e._id)))}),(0,P.jsx)(L.A,{error:E.touched.landers&&Boolean(E.errors.landers),children:E.touched.landers&&E.errors.landers})]})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Loan Status"}),(0,P.jsxs)(S.A,{fullWidth:!0,children:[(0,P.jsxs)(T.A,{labelId:"demo-simple-select-label",id:"",name:"loanStatus",label:"",size:"small",value:E.values.loanStatus||null,onChange:E.handleChange,error:E.touched.loanStatus&&Boolean(E.errors.loanStatus),children:[(0,P.jsx)(B.A,{value:"pending",children:"Processing"}),(0,P.jsx)(B.A,{value:"approved",children:"Approved"}),(0,P.jsx)(B.A,{value:"denied",children:"Denied"}),(0,P.jsx)(B.A,{value:"defaulted",children:"Defaulted"}),(0,P.jsx)(B.A,{value:"fullyPaid",children:"Fully Paid"})]}),(0,P.jsx)(L.A,{error:E.touched.loanStatus&&Boolean(E.errors.loanStatus),children:E.touched.loanStatus&&E.errors.loanStatus})]})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Principle Amount"}),(0,P.jsx)(b.A,{id:"principleAmount",name:"principleAmount",size:"small",type:"number",fullWidth:!0,value:E.values.principleAmount,onChange:E.handleChange,error:E.touched.principleAmount&&Boolean(E.errors.principleAmount),helperText:E.touched.principleAmount&&E.errors.principleAmount})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Loan Duration ( In Yearly)"}),(0,P.jsx)(b.A,{id:"loanDuration",name:"loanDuration",size:"small",type:"number",fullWidth:!0,value:E.values.loanDuration,onChange:e=>{const r=e.target.value;E.setFieldValue("loanDuration",r);const a=E.values.principleAmount,l=E.values.interestRate,n=E.values.durationPeriod;U(a,l,r,n)},error:E.touched.loanDuration&&Boolean(E.errors.loanDuration),helperText:E.touched.loanDuration&&E.errors.loanDuration})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Duration Period"}),(0,P.jsx)(b.A,{id:"durationPeriod",name:"durationPeriod",size:"small",fullWidth:!0,value:E.values.durationPeriod,onChange:E.handleChange,disabled:Boolean(E.values.durationPeriod),error:E.touched.durationPeriod&&Boolean(E.errors.durationPeriod),helperText:E.touched.durationPeriod&&E.errors.durationPeriod})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Loan Release Date"}),(0,P.jsx)(b.A,{name:"releaseDate",type:"date",size:"small",fullWidth:!0,value:q()(E.values.releaseDate).format("YYYY-MM-DD"),onChange:E.handleChange,error:E.touched.releaseDate&&Boolean(E.errors.releaseDate),helperText:E.touched.releaseDate&&E.errors.releaseDate})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:6,children:[(0,P.jsx)(R.A,{children:"Repayment Amount"}),(0,P.jsx)(b.A,{id:"repaymentAmount",name:"repaymentAmount",size:"small",type:"number",fullWidth:!0,value:E.values.repaymentAmount,onChange:E.handleChange,error:E.touched.loanDuration&&Boolean(E.errors.repaymentAmount),helperText:E.touched.repaymentAmount&&E.errors.repaymentAmount})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,children:[(0,P.jsx)(R.A,{children:"Interest Amount"}),(0,P.jsx)(b.A,{id:"interestAmount",name:"interestAmount",size:"small",fullWidth:!0,value:E.values.interestAmount,onChange:E.handleChange,error:E.touched.interestAmount&&Boolean(E.errors.interestAmount),helperText:E.touched.interestAmount&&E.errors.interestAmount})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,children:[(0,P.jsx)(R.A,{children:"Interest Rate"}),(0,P.jsx)(b.A,{id:"interestRate",name:"interestRate",size:"small",fullWidth:!0,value:E.values.interestRate,onChange:E.handleChange,disabled:Boolean(E.values.interestRate),error:E.touched.interestRate&&Boolean(E.errors.interestRate),helperText:E.touched.interestRate&&E.errors.interestRate})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,children:[(0,P.jsx)(R.A,{children:"From this Account"}),(0,P.jsxs)(S.A,{fullWidth:!0,children:[(0,P.jsx)(T.A,{labelId:"demo-simple-select-label",id:"",name:"fromAccount",label:"",size:"small",value:E.values.fromAccount||null,onChange:E.handleChange,error:E.touched.fromAccount&&Boolean(E.errors.fromAccount),children:null===u||void 0===u?void 0:u.map((e=>(0,P.jsx)(B.A,{value:e._id,children:`${e.walletName}- Balance: ${e.addFunds}`},e._id)))}),(0,P.jsx)(L.A,{error:E.touched.fromAccount&&Boolean(E.errors.fromAccount),children:E.touched.fromAccount&&E.errors.fromAccount})]})]}),(0,P.jsxs)(p.Ay,{item:!0,xs:12,sm:6,children:[(0,P.jsx)(R.A,{children:"Transaction Reference"}),(0,P.jsx)(b.A,{id:"TransactionReference",name:"TransactionReference",size:"small",fullWidth:!0,value:E.values.TransactionReference,onChange:E.handleChange,error:E.touched.TransactionReference&&Boolean(E.errors.TransactionReference),helperText:E.touched.TransactionReference&&E.errors.TransactionReference})]})]})})})}),(0,P.jsxs)(w.A,{children:[(0,P.jsx)(d.A,{type:"submit",variant:"contained",onClick:E.handleSubmit,style:{textTransform:"capitalize"},color:"secondary",children:"Save"}),(0,P.jsx)(d.A,{type:"reset",variant:"outlined",style:{textTransform:"capitalize"},onClick:()=>{E.resetForm(),m(""),a()},color:"error",children:"Cancel"})]})]})})},F=a(7999),_=a(57988),$=a(48875),Y=a(27702),O=a(20660),W=a(13564);var V=()=>{const e=localStorage.getItem("user_id"),r=(0,W.Zp)(),[a,A]=(0,l.useState)(!1),[x,f]=(0,l.useState)(!1),[v,p]=(0,l.useState)([]),[j,y]=(0,l.useState)([]),[b,w]=(0,l.useState)([]),[D,g]=(0,l.useState)([]),[C,R]=(0,l.useState)([]),[S,T]=(0,l.useState)([]),[B,L]=(0,l.useState)(""),[N,k]=(0,l.useState)([]),[q,z]=(0,l.useState)([]),V=()=>A(!0),E=()=>f(!1),M=async()=>{const r=await(0,Y.x4)(`loan/list?createdBy=${e}`);r&&200===r.status&&p(r.data.getAllResult)};(0,l.useEffect)((()=>{M(),(async()=>{const r=await(0,Y.x4)(`loanType/list?createdBy=${e}`);r&&200===r.status&&y(r.data.getAllResult)})(),(async()=>{const r=await(0,Y.x4)(`borrower/list?createdBy=${e}`);if(r&&200===r.status){const e=r.data.borrowerAllData.filter((e=>"verified"===e.status));w(e)}})(),(async()=>{const r=await(0,Y.x4)(`Wallet/list?createdBy=${e}`);r&&200===r.status&&R(r.data.getAllResult)})(),(async()=>{const r=await(0,Y.x4)(`currency/list?createdBy=${e}`);if(r&&200===r.status){const e=r.data.getAllResult.filter((e=>"active"===e.currencyStatus));k(e)}})(),(async()=>{const r=await(0,Y.x4)(`landers/list?createdBy=${e}`);var a;r&&200===r.status&&g(null===r||void 0===r||null===(a=r.data)||void 0===a?void 0:a.getAllResult)})(),(async()=>{const r=await(0,Y.x4)(`loanOffers/list?createdBy=${e}`);if(r&&200===r.status){const e=r.data.getAllResult.filter((e=>"active"===e.status));z(e)}})()}),[]);const U=(e,r,a)=>{const l=new Date(e);let n=new Date(l);switch(a){case"daily":n.setDate(n.getDate()+r);break;case"weekly":n.setDate(n.getDate()+7*r);break;case"monthly":n.setMonth(n.getMonth()+r);break;case"yearly":n.setFullYear(n.getFullYear()+r);break;default:return null}return n},G=[{field:"_id",headerName:"S.No.",flex:.5,cellClassName:"name-column--cell name-column--cell--capitalize",renderCell:e=>e.api.getAllRowIds().indexOf(e.id)+1},{field:"loanNumber",headerName:"Loan Number",flex:1,cellClassName:"name-column--cell name-column--cell--capitalize",renderCell:e=>{var a;return(0,P.jsx)(n.A,{onClick:()=>{var a;const l=null===e||void 0===e||null===(a=e.row)||void 0===a?void 0:a._id;r(`/Loans/loanList/View/${l}`)},style:{cursor:"pointer"},children:(0,P.jsx)(t.A,{children:null===e||void 0===e||null===(a=e.row)||void 0===a?void 0:a.loanNumber})})}},{field:"borrowers",headerName:"Borrowers",flex:1,renderCell:e=>{var r,a,l;return(0,P.jsx)(t.A,{children:null!==(r=e.row.borrowers)&&void 0!==r&&r.firstName?`${null===(a=e.row.borrowers)||void 0===a?void 0:a.firstName} ${null===(l=e.row.borrowers)||void 0===l?void 0:l.lastName}`:"--"})}},{field:"loanType",headerName:" Loan Type",flex:1},{field:"repaymentAmount",headerName:"Total Amount",flex:1,renderCell:e=>{var r,a;return(0,P.jsxs)(t.A,{children:[`${null===(r=N[0])||void 0===r?void 0:r.currencySymbol} ${null===e||void 0===e||null===(a=e.row)||void 0===a?void 0:a.repaymentAmount}`," "]})}},{field:"dueDate",headerName:"Due Date",flex:1,cellClassName:"name-column--cell--capitalize",renderCell:e=>{var r,a,l,n,o;return(0,P.jsx)(t.A,{children:null!==e&&void 0!==e&&null!==(r=e.row)&&void 0!==r&&r.releaseDate?null===(a=U(null===e||void 0===e||null===(l=e.row)||void 0===l?void 0:l.releaseDate,null===e||void 0===e||null===(n=e.row)||void 0===n?void 0:n.loanDuration,null===e||void 0===e||null===(o=e.row)||void 0===o?void 0:o.durationPeriod))||void 0===a?void 0:a.toDateString():"-"})}},{field:"loanStatus",headerName:"Loan Status",flex:1},{field:"action",headerName:"Action",flex:1,renderCell:e=>{const r=e=>{T(e._id),f(!0)};return(0,P.jsxs)(n.A,{children:[(0,P.jsx)(o.A,{fontSize:"40px",color:"primary",onClick:()=>{var r;r=null===e||void 0===e?void 0:e.row,L(r),V()},children:(0,P.jsx)(F.A,{})}),(0,P.jsx)(o.A,{color:"error",onClick:()=>{r(null===e||void 0===e?void 0:e.row)},children:(0,P.jsx)(_.A,{})})]})}}];return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O.A,{openDelete:x,handleCloseDelete:E,deleteId:S,deleteData:async e=>{const r=await(0,Y.Gx)(`loan/delete/${e}`,e);r&&200===r.status&&M(),E()}}),(0,P.jsx)(I,{open:a,handleClose:()=>A(!1),AddLoanData:async e=>{const r=e,a=await(0,Y.d_)("loan/add",r);a&&201===a.status&&M()},loanTypeData:j,borrowerData:b,walletData:C,editLoanData:B,setEditLoanData:L,UpDateLoanData:async e=>{const r=e,a=await(0,Y.X4)(`loan/edit/${B._id}`,r);a&&200===a.status&&M()},landersData:D,loanOffersData:q}),(0,P.jsxs)(s.A,{children:[(0,P.jsxs)(i.A,{direction:"row",alignItems:"center",mb:5,justifyContent:"space-between",children:[(0,P.jsx)(t.A,{variant:"h4",children:"Loans Lists"}),(0,P.jsx)(i.A,{direction:"row",alignItems:"center",justifyContent:"flex-end",spacing:2,children:(0,P.jsx)(d.A,{variant:"contained",startIcon:(0,P.jsx)($.A,{icon:"eva:plus-fill"}),onClick:V,children:"New loan"})})]}),(0,P.jsx)(c.A,{children:(0,P.jsx)(n.A,{width:"100%",children:(0,P.jsx)(u.A,{style:{height:"600px",paddingTop:"15px"},children:(0,P.jsx)(m.zh,{rows:null!==v&&void 0!==v?v:[],columns:G,getRowId:e=>e._id,slots:{toolbar:h.O},slotProps:{toolbar:{showQuickFilter:!0}}})})})})]})]})}}}]);